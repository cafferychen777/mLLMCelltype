<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Frequently Asked Questions • mLLMCelltype</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Frequently Asked Questions">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<style>
  /* Fix for navbar overlapping main content */
  main {
    padding-top: 70px; /* Adjust this value as needed */
  }
  /* Improve spacing for better readability */
  .page-header {
    margin-top: 20px;
  }
  /* Ensure content has enough space from the top on mobile */
  @media (max-width: 767px) {
    main {
      padding-top: 80px; /* Slightly more padding on mobile */
    }
  }
  /* Better spacing for section headers */
  h2, h3, h4 {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
</style>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mLLMCelltype</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/01-introduction.html">Introduction</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Function Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/index.html">All Articles</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/01-introduction.html">Introduction to mLLMCelltype</a></li>
    <li><a class="dropdown-item" href="../articles/02-installation.html">Installation Guide</a></li>
    <li><a class="dropdown-item" href="../articles/03-getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Usage and Features</h6></li>
    <li><a class="dropdown-item" href="../articles/04-usage-tutorial.html">Usage Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/05-consensus-principles.html">Consensus Annotation Principles</a></li>
    <li><a class="dropdown-item" href="../articles/06-visualization-guide.html">Visualization Guide</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/07-faq.html">Frequently Asked Questions</a></li>
    <li><a class="dropdown-item" href="../articles/08-advanced-features.html">Advanced Features &amp; Case Studies</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Development</h6></li>
    <li><a class="dropdown-item" href="../articles/09-contributing-guide.html">Contributing Guide</a></li>
    <li><a class="dropdown-item" href="../articles/10-version-history.html">Version History &amp; Changelog</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://www.biorxiv.org/content/10.1101/2025.04.10.647852v1" aria-label="Paper"><span class="bi bi-file-earmark-text"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cafferychen777/mLLMCelltype" aria-label="GitHub"><span class="bi bi-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Frequently Asked Questions</h1>
                        <h4 data-toc-skip class="author">Chen Yang</h4>
            
            <h4 data-toc-skip class="date">2025-04-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cafferychen777/mLLMCelltype/blob/dev/vignettes/07-faq.Rmd" class="external-link"><code>vignettes/07-faq.Rmd</code></a></small>
      <div class="d-none name"><code>07-faq.Rmd</code></div>
    </div>

    
    
<p><img src="../reference/figures/logo.png" align="right" height="139"></p>
<div class="section level2">
<h2 id="frequently-asked-questions">Frequently Asked Questions<a class="anchor" aria-label="anchor" href="#frequently-asked-questions"></a>
</h2>
<p>This document addresses common questions about using mLLMCelltype for
cell type annotation in single-cell RNA sequencing data.</p>
<div class="section level3">
<h3 id="general-questions">General Questions<a class="anchor" aria-label="anchor" href="#general-questions"></a>
</h3>
<div class="section level4">
<h4 id="what-makes-mllmcelltype-different-from-other-cell-type-annotation-tools">What makes mLLMCelltype different from other cell type annotation
tools?<a class="anchor" aria-label="anchor" href="#what-makes-mllmcelltype-different-from-other-cell-type-annotation-tools"></a>
</h4>
<p>mLLMCelltype differs from traditional cell type annotation tools in
several key ways:</p>
<ol style="list-style-type: decimal">
<li><p><strong>No reference dataset required</strong>: Unlike
reference-based methods, mLLMCelltype doesn’t require a pre-existing
reference dataset.</p></li>
<li><p><strong>Multi-model consensus</strong>: mLLMCelltype leverages
multiple large language models to achieve more reliable annotations than
any single model could provide.</p></li>
<li><p><strong>Transparent reasoning</strong>: The package provides
complete reasoning chains for annotations, making the process
interpretable and transparent.</p></li>
<li><p><strong>Uncertainty quantification</strong>: mLLMCelltype
provides explicit uncertainty metrics (consensus proportion and Shannon
entropy) to identify ambiguous cell populations.</p></li>
<li><p><strong>Structured deliberation</strong>: For controversial
clusters, mLLMCelltype initiates a structured discussion process among
models to reach a more reliable consensus.</p></li>
</ol>
</div>
<div class="section level4">
<h4 id="which-tissues-and-species-does-mllmcelltype-support">Which tissues and species does mLLMCelltype support?<a class="anchor" aria-label="anchor" href="#which-tissues-and-species-does-mllmcelltype-support"></a>
</h4>
<p>mLLMCelltype can annotate cell types from virtually any tissue and
species, as it relies on the biological knowledge embedded in large
language models rather than pre-defined reference datasets. However,
performance may vary depending on how well-characterized the tissue is
in the scientific literature.</p>
<p>The package has been extensively tested on: - Human tissues (PBMC,
bone marrow, brain, lung, liver, kidney, etc.) - Mouse tissues (brain,
lung, kidney, etc.) - Other model organisms (zebrafish, fruit fly,
etc.)</p>
<p>For very specialized or poorly characterized tissues, the uncertainty
metrics will help identify clusters that may require expert review.</p>
</div>
<div class="section level4">
<h4 id="how-accurate-is-mllmcelltype-compared-to-other-methods">How accurate is mLLMCelltype compared to other methods?<a class="anchor" aria-label="anchor" href="#how-accurate-is-mllmcelltype-compared-to-other-methods"></a>
</h4>
<p>In our benchmarking studies (see our <a href="https://doi.org/10.1101/2025.04.10.647852" class="external-link">paper</a>),
mLLMCelltype consistently outperformed both traditional annotation
methods and single-LLM approaches:</p>
<ul>
<li>Compared to reference-based methods (e.g., SingleR, Seurat label
transfer), mLLMCelltype showed comparable or better performance without
requiring a reference dataset.</li>
<li>Compared to marker-based methods (e.g., SCINA, CellAssign),
mLLMCelltype demonstrated higher accuracy and flexibility.</li>
<li>Compared to single-LLM approaches, the consensus mechanism improved
accuracy by 15-30% depending on the tissue type.</li>
</ul>
<p>The accuracy advantage is particularly pronounced for rare cell types
and tissues with limited reference data.</p>
</div>
</div>
<div class="section level3">
<h3 id="technical-questions">Technical Questions<a class="anchor" aria-label="anchor" href="#technical-questions"></a>
</h3>
<div class="section level4">
<h4 id="how-does-mllmcelltype-handle-0-based-vs--1-based-cluster-indices">How does mLLMCelltype handle 0-based vs. 1-based cluster
indices?<a class="anchor" aria-label="anchor" href="#how-does-mllmcelltype-handle-0-based-vs--1-based-cluster-indices"></a>
</h4>
<p>mLLMCelltype strictly works with 0-based cluster indices, which is
compatible with Seurat’s default indexing. This means:</p>
<ul>
<li>Cluster indices should start from 0, not 1</li>
<li>If your data uses 1-based indexing, you need to convert it to
0-based before using mLLMCelltype</li>
<li>The package performs validation to ensure that cluster indices start
from 0</li>
</ul>
<p>This design choice was made to ensure compatibility with Seurat,
which is one of the most widely used single-cell analysis
frameworks.</p>
</div>
<div class="section level4">
<h4 id="what-is-the-recommended-number-of-marker-genes-per-cluster">What is the recommended number of marker genes per cluster?<a class="anchor" aria-label="anchor" href="#what-is-the-recommended-number-of-marker-genes-per-cluster"></a>
</h4>
<p>The default setting uses the top 10 marker genes per cluster, which
works well for most scenarios. However, you can adjust this using the
<code>top_gene_count</code> parameter:</p>
<ul>
<li>For well-characterized cell types: 5-10 marker genes is usually
sufficient</li>
<li>For rare or poorly characterized cell types: 10-20 marker genes may
be beneficial</li>
<li>For noisy data: Fewer genes (5-7) might give better results by
focusing on the strongest signals</li>
</ul>
<p>The optimal number depends on the quality of your marker genes and
the complexity of the tissue. We recommend starting with the default of
10 and adjusting based on the results.</p>
</div>
<div class="section level4">
<h4 id="how-does-caching-work-in-mllmcelltype">How does caching work in mLLMCelltype?<a class="anchor" aria-label="anchor" href="#how-does-caching-work-in-mllmcelltype"></a>
</h4>
<p>mLLMCelltype implements a caching system to avoid redundant API
calls, which saves time and reduces costs:</p>
<ul>
<li>By default, caching is enabled (<code>cache = TRUE</code>)</li>
<li>The cache is based on a hash of the input data, model, and other
parameters</li>
<li>Results are stored in a local directory (default: a temporary
directory)</li>
<li>You can specify a custom cache directory using the
<code>cache_dir</code> parameter</li>
</ul>
<p>To clear the cache:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cache_manager</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CacheManager.html">CacheManager</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cache_manager</span><span class="op">$</span><span class="fu">clear_cache</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>To disable caching for a specific run:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotate_cell_types.html">annotate_cell_types</a></span><span class="op">(</span><span class="va">...</span>, cache <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="how-does-mllmcelltype-handle-rate-limits-and-api-errors">How does mLLMCelltype handle rate limits and API errors?<a class="anchor" aria-label="anchor" href="#how-does-mllmcelltype-handle-rate-limits-and-api-errors"></a>
</h4>
<p>The package includes robust error handling for API calls:</p>
<ul>
<li>Automatic retries: Failed API calls are automatically retried up to
<code>max_retries</code> times (default: 3)</li>
<li>Exponential backoff: Each retry waits longer to accommodate rate
limits</li>
<li>Detailed error messages: When an API call fails permanently, the
error message includes details to help diagnose the issue</li>
</ul>
<p>If you’re processing many clusters, you might encounter rate limits.
In this case:</p>
<ol style="list-style-type: decimal">
<li>Increase the <code>timeout</code> parameter (default: 60
seconds)</li>
<li>Reduce the number of models used for initial annotation</li>
<li>Process batches of clusters separately with pauses between
batches</li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="performance-and-optimization">Performance and Optimization<a class="anchor" aria-label="anchor" href="#performance-and-optimization"></a>
</h3>
<div class="section level4">
<h4 id="how-long-does-it-take-to-run-mllmcelltype">How long does it take to run mLLMCelltype?<a class="anchor" aria-label="anchor" href="#how-long-does-it-take-to-run-mllmcelltype"></a>
</h4>
<p>The runtime depends on several factors:</p>
<ul>
<li>
<strong>Number of clusters</strong>: Each cluster requires separate
API calls</li>
<li>
<strong>Number of models</strong>: More models means more API
calls</li>
<li>
<strong>Discussion process</strong>: Controversial clusters require
additional API calls for discussion</li>
<li>
<strong>API response times</strong>: Different providers have
different response times</li>
<li>
<strong>Network conditions</strong>: Internet speed and reliability
affect performance</li>
</ul>
<p>Typical runtimes: - Single model, 10 clusters: 1-2 minutes -
Multi-model consensus (3 models), 10 clusters: 3-5 minutes - Multi-model
consensus with discussion, 10 clusters: 5-10 minutes</p>
<p>To optimize runtime: - Enable caching to reuse results - Start with
fewer models for initial exploration - Use a higher
<code>discussion_threshold</code> to reduce the number of controversial
clusters - Process large datasets in batches</p>
</div>
<div class="section level4">
<h4 id="what-are-the-api-costs-associated-with-using-mllmcelltype">What are the API costs associated with using mLLMCelltype?<a class="anchor" aria-label="anchor" href="#what-are-the-api-costs-associated-with-using-mllmcelltype"></a>
</h4>
<p>The API costs depend on the models you use and the number of
clusters:</p>
<ul>
<li>
<strong>OpenAI models</strong> (GPT-4o, etc.): $0.01-0.05 per
cluster for annotation</li>
<li>
<strong>Anthropic models</strong> (Claude 3.7, etc.): $0.01-0.03 per
cluster for annotation</li>
<li>
<strong>Google models</strong> (Gemini 1.5, etc.): $0.001-0.01 per
cluster for annotation</li>
<li>
<strong>Other models</strong>: Generally lower cost</li>
<li>
<strong>OpenRouter free models</strong>: $0.00 (free with
<code>:free</code> suffix)</li>
</ul>
<p>For a typical dataset with 10-20 clusters: - Single model annotation:
$0.10-1.00 total - Multi-model consensus (3 models): $0.30-3.00 total -
With discussion process: Additional $0.10-1.00 - Using OpenRouter free
models: $0.00 total</p>
<p>To reduce costs: - Use caching to avoid redundant API calls - Start
with more economical models - Use fewer models for initial exploration -
Reserve multi-model consensus for final analysis - Consider using
OpenRouter free models (see below)</p>
</div>
<div class="section level4">
<h4 id="how-can-i-use-openrouter-free-models">How can I use OpenRouter free models?<a class="anchor" aria-label="anchor" href="#how-can-i-use-openrouter-free-models"></a>
</h4>
<p>OpenRouter provides access to several high-quality models for
free:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Sign up for an OpenRouter account</strong> at <a href="https://openrouter.ai/keys" class="external-link">openrouter.ai</a></p></li>
<li><p><strong>Get your API key</strong> from the OpenRouter
dashboard</p></li>
<li><p><strong>Use models with the <code>:free</code>
suffix</strong>:</p></li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set your OpenRouter API key</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>OPENROUTER_API_KEY <span class="op">=</span> <span class="st">"your-openrouter-api-key"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use a free model</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotate_cell_types.html">annotate_cell_types</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="va">marker_data</span>,</span>
<span>  tissue_name <span class="op">=</span> <span class="st">"human PBMC"</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"meta-llama/llama-4-maverick:free"</span>,  <span class="co"># Note the :free suffix</span></span>
<span>  api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OPENROUTER_API_KEY"</span><span class="op">)</span>,</span>
<span>  provider <span class="op">=</span> <span class="st">"openrouter"</span>  <span class="co"># Specify OpenRouter as the provider</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>
<strong>Recommended free models</strong>:
<ul>
<li>
<code>meta-llama/llama-4-maverick:free</code> - Meta Llama 4
Maverick (256K context)</li>
<li>
<code>nvidia/llama-3.1-nemotron-ultra-253b-v1:free</code> - NVIDIA
Nemotron Ultra 253B</li>
<li>
<code>deepseek/deepseek-chat-v3-0324:free</code> - DeepSeek Chat
v3</li>
<li>
<code>microsoft/mai-ds-r1:free</code> - Microsoft MAI-DS-R1</li>
</ul>
</li>
</ol>
<p>Free models don’t consume credits but may have limitations compared
to paid models.</p>
</div>
<div class="section level4">
<h4 id="how-can-i-improve-the-accuracy-of-annotations">How can I improve the accuracy of annotations?<a class="anchor" aria-label="anchor" href="#how-can-i-improve-the-accuracy-of-annotations"></a>
</h4>
<p>To get the most accurate annotations:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Use multiple high-quality models</strong>: Include
diverse, high-performing models like Claude 3.7, GPT-4o, and Gemini
1.5</p></li>
<li><p><strong>Provide good marker genes</strong>: Use robust
differential expression analysis to identify strong marker
genes</p></li>
<li><p><strong>Specify the correct tissue</strong>: Always provide the
correct tissue name to give models the proper context</p></li>
<li><p><strong>Review uncertainty metrics</strong>: Pay attention to
consensus proportion and Shannon entropy to identify clusters that may
need manual review</p></li>
<li><p><strong>Examine discussion logs</strong>: For controversial
clusters, review the discussion logs to understand the
reasoning</p></li>
<li><p><strong>Iterate if needed</strong>: If results are
unsatisfactory, try adjusting parameters or providing additional
context</p></li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h3>
<div class="section level4">
<h4 id="why-am-i-getting-different-results-with-the-same-input">Why am I getting different results with the same input?<a class="anchor" aria-label="anchor" href="#why-am-i-getting-different-results-with-the-same-input"></a>
</h4>
<p>There are several possible reasons for getting different results with
the same input:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Model updates</strong>: LLMs are regularly updated, which
can change their outputs</p></li>
<li><p><strong>Temperature/sampling</strong>: Some randomness is
inherent in LLM outputs</p></li>
<li><p><strong>Context window limitations</strong>: Different runs might
include slightly different context</p></li>
<li><p><strong>API changes</strong>: Providers may change how their APIs
work</p></li>
</ol>
<p>To ensure reproducibility: - Use caching to reuse results - Specify
model versions explicitly when available - Set a random seed if the API
supports it - Save and document your results</p>
</div>
<div class="section level4">
<h4 id="im-getting-an-error-about-invalid-cluster-indices--what-should-i-do">I’m getting an error about invalid cluster indices. What should I
do?<a class="anchor" aria-label="anchor" href="#im-getting-an-error-about-invalid-cluster-indices--what-should-i-do"></a>
</h4>
<p>If you see an error like “Cluster indices must start from 0”, it
means your data is using 1-based indexing instead of the required
0-based indexing. To fix this:</p>
<ol style="list-style-type: decimal">
<li>Check your cluster column to ensure it starts from 0, not 1</li>
<li>If using Seurat’s FindAllMarkers output, this should already be
0-based</li>
<li>If your data is 1-based, convert it:</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert 1-based to 0-based indexing</span></span>
<span><span class="va">markers</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="va">markers</span><span class="op">$</span><span class="va">cluster</span> <span class="op">-</span> <span class="fl">1</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="how-do-i-handle-api-key-not-found-errors">How do I handle “API key not found” errors?<a class="anchor" aria-label="anchor" href="#how-do-i-handle-api-key-not-found-errors"></a>
</h4>
<p>If you get an error about missing API keys:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Check environment variables</strong>: Ensure your API
keys are set correctly in your <code>.env</code> file or
environment</p></li>
<li><p><strong>Provide keys directly</strong>: Pass the API key directly
to the function:</p></li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotate_cell_types.html">annotate_cell_types</a></span><span class="op">(</span><span class="va">...</span>, api_key <span class="op">=</span> <span class="st">"your-api-key"</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>
<strong>Check provider name</strong>: Make sure you’re using the
correct provider name for your API key:</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set API key for a specific provider</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>ANTHROPIC_API_KEY <span class="op">=</span> <span class="st">"your-anthropic-key"</span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>
<strong>Verify key validity</strong>: Check if your API key is still
valid by testing it directly with the provider’s API</li>
</ol>
</div>
<div class="section level4">
<h4 id="why-are-some-cell-types-not-being-correctly-identified">Why are some cell types not being correctly identified?<a class="anchor" aria-label="anchor" href="#why-are-some-cell-types-not-being-correctly-identified"></a>
</h4>
<p>If specific cell types are not being correctly identified:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Check marker genes</strong>: Ensure the marker genes for
these cell types are strong and specific</p></li>
<li><p><strong>Provide more context</strong>: Specify the tissue type
accurately to give models the right context</p></li>
<li><p><strong>Use more models</strong>: Different models have different
strengths; using multiple models improves coverage</p></li>
<li><p><strong>Increase marker count</strong>: Try increasing
<code>top_gene_count</code> to include more marker genes</p></li>
<li><p><strong>Review discussion logs</strong>: For controversial
clusters, examine the discussion to understand the reasoning</p></li>
<li><p><strong>Consider rare cell types</strong>: Some cell types may be
poorly represented in the training data of LLMs</p></li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="integration-with-other-tools">Integration with Other Tools<a class="anchor" aria-label="anchor" href="#integration-with-other-tools"></a>
</h3>
<div class="section level4">
<h4 id="how-does-mllmcelltype-integrate-with-seurat">How does mLLMCelltype integrate with Seurat?<a class="anchor" aria-label="anchor" href="#how-does-mllmcelltype-integrate-with-seurat"></a>
</h4>
<p>mLLMCelltype integrates seamlessly with Seurat:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Input</strong>: You can directly use Seurat’s
<code><a href="https://satijalab.org/seurat/reference/FindAllMarkers.html" class="external-link">FindAllMarkers()</a></code> output as input</p></li>
<li><p><strong>Output</strong>: Annotation results can be easily added
to your Seurat object:</p></li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seurat_obj</span><span class="op">$</span><span class="va">cell_type_consensus</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html" class="external-link">mapvalues</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/Idents.html" class="external-link">Idents</a></span><span class="op">(</span><span class="va">seurat_obj</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">consensus_results</span><span class="op">$</span><span class="va">final_annotations</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="va">consensus_results</span><span class="op">$</span><span class="va">final_annotations</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>
<strong>Visualization</strong>: Use Seurat’s visualization functions
with the added annotations:</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">seurat_obj</span>, group.by <span class="op">=</span> <span class="st">"cell_type_consensus"</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="can-i-use-mllmcelltype-with-scanpyanndata-in-r">Can I use mLLMCelltype with Scanpy/AnnData in R?<a class="anchor" aria-label="anchor" href="#can-i-use-mllmcelltype-with-scanpyanndata-in-r"></a>
</h4>
<p>Yes, you can use mLLMCelltype with Scanpy/AnnData objects in R:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Extract marker genes</strong>: Export marker genes from
your Scanpy analysis to a CSV file</p></li>
<li><p><strong>Run mLLMCelltype</strong>: Use the CSV file as input to
mLLMCelltype</p></li>
<li><p><strong>Import results</strong>: Add the annotation results back
to your AnnData object</p></li>
</ol>
<p>Alternatively, you can use the Python version of mLLMCelltype for
direct integration with Scanpy.</p>
</div>
<div class="section level4">
<h4 id="how-can-i-combine-mllmcelltype-with-traditional-annotation-methods">How can I combine mLLMCelltype with traditional annotation
methods?<a class="anchor" aria-label="anchor" href="#how-can-i-combine-mllmcelltype-with-traditional-annotation-methods"></a>
</h4>
<p>mLLMCelltype can be used alongside traditional annotation
methods:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Complementary approach</strong>: Use both methods and
compare results</p></li>
<li><p><strong>Validation</strong>: Use mLLMCelltype to validate
annotations from reference-based methods</p></li>
<li><p><strong>Hybrid approach</strong>: Use reference-based methods for
well-characterized cell types and mLLMCelltype for novel or rare cell
types</p></li>
<li><p><strong>Ensemble method</strong>: Create a consensus between
mLLMCelltype and traditional methods</p></li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="advanced-usage">Advanced Usage<a class="anchor" aria-label="anchor" href="#advanced-usage"></a>
</h3>
<div class="section level4">
<h4 id="how-can-i-customize-the-prompts-used-by-mllmcelltype">How can I customize the prompts used by mLLMCelltype?<a class="anchor" aria-label="anchor" href="#how-can-i-customize-the-prompts-used-by-mllmcelltype"></a>
</h4>
<p>While mLLMCelltype uses carefully designed prompts, advanced users
can customize them:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a custom annotation prompt</span></span>
<span><span class="va">custom_prompt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_annotation_prompt.html">create_annotation_prompt</a></span><span class="op">(</span></span>
<span>  marker_data <span class="op">=</span> <span class="va">your_markers</span>,</span>
<span>  tissue_name <span class="op">=</span> <span class="st">"your_tissue"</span>,</span>
<span>  top_gene_count <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  custom_instructions <span class="op">=</span> <span class="st">"Also consider developmental stage and activation state."</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the custom prompt directly</span></span>
<span><span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_model_response.html">get_model_response</a></span><span class="op">(</span></span>
<span>  prompt <span class="op">=</span> <span class="va">custom_prompt</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"claude-3-7-sonnet-20250219"</span>,</span>
<span>  api_key <span class="op">=</span> <span class="va">your_api_key</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="can-i-add-my-own-custom-llm-models">Can I add my own custom LLM models?<a class="anchor" aria-label="anchor" href="#can-i-add-my-own-custom-llm-models"></a>
</h4>
<p>Yes, you can register custom models and providers:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Register a custom provider</span></span>
<span><span class="fu"><a href="../reference/register_custom_provider.html">register_custom_provider</a></span><span class="op">(</span></span>
<span>  provider_name <span class="op">=</span> <span class="st">"my_provider"</span>,</span>
<span>  api_url <span class="op">=</span> <span class="st">"https://api.my-provider.com/v1/chat/completions"</span>,</span>
<span>  api_key_env_var <span class="op">=</span> <span class="st">"MY_PROVIDER_API_KEY"</span>,</span>
<span>  process_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">prompt</span>, <span class="va">api_key</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Custom implementation</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Register a custom model</span></span>
<span><span class="fu"><a href="../reference/register_custom_model.html">register_custom_model</a></span><span class="op">(</span></span>
<span>  model_name <span class="op">=</span> <span class="st">"my-custom-model"</span>,</span>
<span>  provider <span class="op">=</span> <span class="st">"my_provider"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the custom model</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotate_cell_types.html">annotate_cell_types</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="va">your_markers</span>,</span>
<span>  tissue_name <span class="op">=</span> <span class="st">"your_tissue"</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"my-custom-model"</span>,</span>
<span>  api_key <span class="op">=</span> <span class="va">your_api_key</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="how-can-i-contribute-to-mllmcelltype">How can I contribute to mLLMCelltype?<a class="anchor" aria-label="anchor" href="#how-can-i-contribute-to-mllmcelltype"></a>
</h4>
<p>We welcome contributions! Here are some ways to contribute:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Report issues</strong>: Report bugs or suggest features
on our <a href="https://github.com/cafferychen777/mLLMCelltype/issues" class="external-link">GitHub
repository</a></p></li>
<li><p><strong>Improve documentation</strong>: Help us improve
documentation and examples</p></li>
<li><p><strong>Add new models</strong>: Implement support for new LLM
models</p></li>
<li><p><strong>Share benchmarks</strong>: Share your benchmarking
results with different tissues and species</p></li>
<li><p><strong>Develop new features</strong>: Contribute code for new
features or improvements</p></li>
</ol>
<p>See our <a href="09-contributing-guide.html">Contributing Guide</a>
for more details.</p>
</div>
</div>
<div class="section level3">
<h3 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h3>
<p>Now that you have answers to common questions, you can explore:</p>
<ul>
<li>
<a href="08-advanced-features.html">Advanced Features</a>: Learn
about hierarchical annotation and other advanced features</li>
<li>
<a href="09-contributing-guide.html">Contributing Guide</a>: Find
out how to contribute to the project</li>
<li>
<a href="10-version-history.html">Version History</a>: Review the
development history of mLLMCelltype</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Chen Yang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2. <br>© 2024 Chen Yang</p>
</div>

    </footer>
</div>





  </body>
</html>
