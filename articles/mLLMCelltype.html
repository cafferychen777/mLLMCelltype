<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>mLLMCelltype: Overview and Quick Reference • mLLMCelltype</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="mLLMCelltype: Overview and Quick Reference">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<style>
  /* Fix for navbar overlapping main content */
  main {
    padding-top: 70px; /* Adjust this value as needed */
  }
  /* Improve spacing for better readability */
  .page-header {
    margin-top: 20px;
  }
  /* Ensure content has enough space from the top on mobile */
  @media (max-width: 767px) {
    main {
      padding-top: 80px; /* Slightly more padding on mobile */
    }
  }
  /* Better spacing for section headers */
  h2, h3, h4 {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
</style>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mLLMCelltype</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/01-introduction.html">Introduction</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Function Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/index.html">All Articles</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/01-introduction.html">Introduction to mLLMCelltype</a></li>
    <li><a class="dropdown-item" href="../articles/02-installation.html">Installation Guide</a></li>
    <li><a class="dropdown-item" href="../articles/03-getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Usage and Features</h6></li>
    <li><a class="dropdown-item" href="../articles/04-usage-tutorial.html">Usage Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/05-consensus-principles.html">Consensus Annotation Principles</a></li>
    <li><a class="dropdown-item" href="../articles/06-visualization-guide.html">Visualization Guide</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/07-faq.html">Frequently Asked Questions</a></li>
    <li><a class="dropdown-item" href="../articles/08-advanced-features.html">Advanced Features &amp; Case Studies</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Development</h6></li>
    <li><a class="dropdown-item" href="../articles/09-contributing-guide.html">Contributing Guide</a></li>
    <li><a class="dropdown-item" href="../articles/10-version-history.html">Version History &amp; Changelog</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://www.biorxiv.org/content/10.1101/2025.04.10.647852v1" aria-label="Paper"><span class="bi bi-file-earmark-text"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cafferychen777/mLLMCelltype" aria-label="GitHub"><span class="bi bi-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>mLLMCelltype: Overview and Quick Reference</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cafferychen777/mLLMCelltype/blob/main/vignettes/mLLMCelltype.Rmd" class="external-link"><code>vignettes/mLLMCelltype.Rmd</code></a></small>
      <div class="d-none name"><code>mLLMCelltype.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cafferyang.com/mLLMCelltype/" class="external-link">mLLMCelltype</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>mLLMCelltype is an R package that leverages various large language
models (LLMs) for automated cell type annotation in single-cell RNA
sequencing data. It implements a consensus-based approach where multiple
LLMs collaborate to provide more reliable annotations. For more details,
please refer to our paper: <a href="https://www.biorxiv.org/content/10.1101/2025.04.10.647852v1" class="external-link">https://www.biorxiv.org/content/10.1101/2025.04.10.647852v1</a>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of mLLMCelltype from CRAN:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"mLLMCelltype"</span><span class="op">)</span></span></code></pre></div>
<p>Or install the development version from GitHub:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"cafferychen777/mLLMCelltype"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-up-api-keys">Setting Up API Keys<a class="anchor" aria-label="anchor" href="#setting-up-api-keys"></a>
</h2>
<p>Before using mLLMCelltype, you need to set up API keys for the LLMs
you want to use. The package supports multiple LLM providers including
OpenAI, Anthropic, Google (Gemini), and X.AI (Grok).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set API keys (recommended to use .Renviron or .env file)</span></span>
<span><span class="co"># OpenAI API key</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>OPENAI_API_KEY <span class="op">=</span> <span class="st">"your-openai-api-key"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Anthropic API key</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>ANTHROPIC_API_KEY <span class="op">=</span> <span class="st">"your-anthropic-api-key"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Google API key</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>GOOGLE_API_KEY <span class="op">=</span> <span class="st">"your-google-api-key"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># X.AI API key</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>XAI_API_KEY <span class="op">=</span> <span class="st">"your-xai-api-key"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Alternatively, use .env file</span></span>
<span><span class="co"># dotenv::load_dot_env()</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<div class="section level3">
<h3 id="annotating-cell-types-with-seurat-object">Annotating Cell Types with Seurat Object<a class="anchor" aria-label="anchor" href="#annotating-cell-types-with-seurat-object"></a>
</h3>
<p>The main function of mLLMCelltype is to annotate cell types in a
Seurat object:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cafferyang.com/mLLMCelltype/" class="external-link">mLLMCelltype</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load your preprocessed Seurat object</span></span>
<span><span class="co"># pbmc &lt;- readRDS("your_seurat_object.rds")</span></span>
<span></span>
<span><span class="co"># Find marker genes for each cluster</span></span>
<span><span class="co"># pbmc_markers &lt;- FindAllMarkers(pbmc,</span></span>
<span><span class="co">#                           only.pos = TRUE,</span></span>
<span><span class="co">#                           min.pct = 0.25,</span></span>
<span><span class="co">#                           logfc.threshold = 0.25)</span></span>
<span></span>
<span><span class="co"># Set up cache directory to speed up processing</span></span>
<span><span class="va">cache_dir</span> <span class="op">&lt;-</span> <span class="st">"./mllmcelltype_cache"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">cache_dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run LLMCelltype annotation with multiple LLM models</span></span>
<span><span class="va">consensus_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interactive_consensus_annotation.html">interactive_consensus_annotation</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="va">pbmc_markers</span>,</span>
<span>  tissue_name <span class="op">=</span> <span class="st">"human PBMC"</span>,  <span class="co"># provide tissue context</span></span>
<span>  models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"claude-3-7-sonnet-20250219"</span>,  <span class="co"># Anthropic</span></span>
<span>    <span class="st">"gpt-4o"</span>,                   <span class="co"># OpenAI</span></span>
<span>    <span class="st">"gemini-2.5-pro"</span>            <span class="co"># Google</span></span>
<span>  <span class="op">)</span>,</span>
<span>  api_keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    anthropic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"ANTHROPIC_API_KEY"</span><span class="op">)</span>,</span>
<span>    openai <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OPENAI_API_KEY"</span><span class="op">)</span>,</span>
<span>    gemini <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"GOOGLE_API_KEY"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  top_gene_count <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  controversy_threshold <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>  entropy_threshold <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>  cache_dir <span class="op">=</span> <span class="va">cache_dir</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add annotations to Seurat object</span></span>
<span><span class="co"># Get cell type annotations from consensus_results$final_annotations</span></span>
<span><span class="va">cluster_to_celltype_map</span> <span class="op">&lt;-</span> <span class="va">consensus_results</span><span class="op">$</span><span class="va">final_annotations</span></span>
<span></span>
<span><span class="co"># Create new cell type identifier column</span></span>
<span><span class="va">cell_types</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/Idents.html" class="external-link">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">cluster_id</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cluster_to_celltype_map</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cell_types</span><span class="op">[</span><span class="va">cell_types</span> <span class="op">==</span> <span class="va">cluster_id</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster_to_celltype_map</span><span class="op">[[</span><span class="va">cluster_id</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Add cell types to Seurat object</span></span>
<span><span class="va">pbmc</span><span class="op">$</span><span class="va">mLLM_cell_type</span> <span class="op">&lt;-</span> <span class="va">cell_types</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-results">Visualizing Results<a class="anchor" aria-label="anchor" href="#visualizing-results"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot UMAP with cell type annotations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Basic visualization</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, group.by <span class="op">=</span> <span class="st">"mLLM_cell_type"</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"mLLMCelltype Consensus Annotations"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize consensus proportion (confidence metric)</span></span>
<span><span class="va">pbmc</span><span class="op">$</span><span class="va">consensus_proportion</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">cluster_id</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">consensus_results</span><span class="op">$</span><span class="va">initial_results</span><span class="op">$</span><span class="va">consensus_results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cluster_cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/Idents.html" class="external-link">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="op">==</span> <span class="va">cluster_id</span><span class="op">)</span></span>
<span>  <span class="va">pbmc</span><span class="op">$</span><span class="va">consensus_proportion</span><span class="op">[</span><span class="va">cluster_cells</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">consensus_results</span><span class="op">$</span><span class="va">initial_results</span><span class="op">$</span><span class="va">consensus_results</span><span class="op">[[</span><span class="va">cluster_id</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">consensus_proportion</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html" class="external-link">FeaturePlot</a></span><span class="op">(</span><span class="va">pbmc</span>, features <span class="op">=</span> <span class="st">"consensus_proportion"</span>,</span>
<span>                 min.cutoff <span class="op">=</span> <span class="fl">0</span>, max.cutoff <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Consensus Proportion"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print consensus summary</span></span>
<span><span class="fu"><a href="../reference/print_consensus_summary.html">print_consensus_summary</a></span><span class="op">(</span><span class="va">consensus_results</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="supported-models">Supported Models<a class="anchor" aria-label="anchor" href="#supported-models"></a>
</h2>
<p>mLLMCelltype supports various LLM models:</p>
<ul>
<li>
<strong>OpenAI</strong>: gpt-4o, gpt-4o-mini, gpt-4.1, gpt-4.1-mini,
gpt-4.1-nano, gpt-4-turbo, gpt-3.5-turbo, o1, o1-mini, o1-preview,
o1-pro</li>
<li>
<strong>Anthropic</strong>: claude-3-7-sonnet-20250219,
claude-3-5-sonnet-latest, claude-3-5-haiku-latest, claude-3-opus</li>
<li>
<strong>DeepSeek</strong>: deepseek-chat, deepseek-reasoner</li>
<li>
<strong>Google</strong>: gemini-2.5-pro, gemini-2.0-flash,
gemini-2.0-flash-exp, gemini-1.5-pro, gemini-1.5-flash</li>
<li>
<strong>Qwen</strong>: qwen-max-2025-01-25, qwen3-72b</li>
<li>
<strong>Stepfun</strong>: step-2-mini, step-2-16k, step-1-8k</li>
<li>
<strong>Zhipu</strong>: glm-4-plus, glm-3-turbo</li>
<li>
<strong>MiniMax</strong>: minimax-text-01</li>
<li>
<strong>Grok</strong>: grok-3, grok-3-latest, grok-3-fast,
grok-3-fast-latest, grok-3-mini, grok-3-mini-latest, grok-3-mini-fast,
grok-3-mini-fast-latest</li>
<li>
<strong>OpenRouter</strong>: Access to models from multiple
providers through a single API</li>
</ul>
</div>
<div class="section level2">
<h2 id="advanced-usage">Advanced Usage<a class="anchor" aria-label="anchor" href="#advanced-usage"></a>
</h2>
<div class="section level3">
<h3 id="using-a-single-llm-model">Using a Single LLM Model<a class="anchor" aria-label="anchor" href="#using-a-single-llm-model"></a>
</h3>
<p>If you only want to use a single LLM model instead of the consensus
approach:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run annotation with a single model</span></span>
<span><span class="va">single_model_results</span> <span class="op">&lt;-</span> <span class="fu">annotate_with_single_model</span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="va">pbmc_markers</span>,</span>
<span>  tissue_name <span class="op">=</span> <span class="st">"human PBMC"</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"claude-3-7-sonnet-20250219"</span>,</span>
<span>  api_key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"ANTHROPIC_API_KEY"</span><span class="op">)</span>,</span>
<span>  top_gene_count <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  cache_dir <span class="op">=</span> <span class="va">cache_dir</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add annotations to Seurat object</span></span>
<span><span class="va">pbmc</span><span class="op">$</span><span class="va">single_model_cell_type</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html" class="external-link">mapvalues</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/Idents.html" class="external-link">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">single_model_results</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="va">single_model_results</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize results</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, group.by <span class="op">=</span> <span class="st">"single_model_cell_type"</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Cell Types Annotated by Single LLM Model"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="customizing-consensus-parameters">Customizing Consensus Parameters<a class="anchor" aria-label="anchor" href="#customizing-consensus-parameters"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Customize consensus parameters</span></span>
<span><span class="va">custom_consensus_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interactive_consensus_annotation.html">interactive_consensus_annotation</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="va">pbmc_markers</span>,</span>
<span>  tissue_name <span class="op">=</span> <span class="st">"human PBMC"</span>,</span>
<span>  models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"claude-3-7-sonnet-20250219"</span>, <span class="st">"gpt-4o"</span>, <span class="st">"gemini-2.5-pro"</span><span class="op">)</span>,</span>
<span>  api_keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    anthropic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"ANTHROPIC_API_KEY"</span><span class="op">)</span>,</span>
<span>    openai <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OPENAI_API_KEY"</span><span class="op">)</span>,</span>
<span>    gemini <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"GOOGLE_API_KEY"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  top_gene_count <span class="op">=</span> <span class="fl">15</span>,                <span class="co"># Number of top marker genes to use</span></span>
<span>  controversy_threshold <span class="op">=</span> <span class="fl">0.7</span>,        <span class="co"># Threshold for controversy detection</span></span>
<span>  entropy_threshold <span class="op">=</span> <span class="fl">0.7</span>,            <span class="co"># Entropy threshold for controversy detection</span></span>
<span>  max_discussion_rounds <span class="op">=</span> <span class="fl">2</span>,          <span class="co"># Maximum rounds of discussion</span></span>
<span>  cache_dir <span class="op">=</span> <span class="va">cache_dir</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-custom-providers">Using Custom Providers<a class="anchor" aria-label="anchor" href="#using-custom-providers"></a>
</h3>
<p>You can register custom LLM providers:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Register a custom provider</span></span>
<span><span class="fu"><a href="../reference/register_custom_provider.html">register_custom_provider</a></span><span class="op">(</span></span>
<span>  provider_name <span class="op">=</span> <span class="st">"my_custom_provider"</span>,</span>
<span>  process_function <span class="op">=</span> <span class="va">my_process_function</span>,</span>
<span>  models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"my-model-1"</span>, <span class="st">"my-model-2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the custom provider</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotate_cell_types.html">annotate_cell_types</a></span><span class="op">(</span></span>
<span>  seurat_obj <span class="op">=</span> <span class="va">seurat_obj</span>,</span>
<span>  models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"my-model-1"</span>, <span class="st">"claude-3-7-sonnet-20250219"</span><span class="op">)</span>,</span>
<span>  <span class="co"># other parameters</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="caching-results">Caching Results<a class="anchor" aria-label="anchor" href="#caching-results"></a>
</h2>
<p>mLLMCelltype includes a caching system to save API costs:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Enable caching</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>MLLM_CACHE_ENABLED <span class="op">=</span> <span class="st">"TRUE"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set cache directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>MLLM_CACHE_DIR <span class="op">=</span> <span class="st">"path/to/cache"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clear cache if needed</span></span>
<span><span class="fu">clear_cache</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>mLLMCelltype provides a powerful and flexible framework for automated
cell type annotation using large language models. By leveraging the
consensus of multiple models, it achieves more reliable annotations than
single-model approaches.</p>
<p>For bug reports or feature requests, please visit: <a href="https://github.com/cafferychen777/mLLMCelltype/issues" class="external-link">https://github.com/cafferychen777/mLLMCelltype/issues</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Chen Yang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2. <br>© 2024 Chen Yang</p>
</div>

    </footer>
</div>





  </body>
</html>
